<ion-content>
  <div class="dashboard-grid">
    <div class="sidebar-left">
      <div class="control-panel">
        <ion-button
          expand="block"
          size="small"
          fill="outline"
          (click)="filterItems()"
        >
          <ion-icon name="funnel-outline" slot="start"></ion-icon>
          {{ filterLabel }}
        </ion-button>
      </div>

      @if (itemImportant.length === 0) {
      <!--boton para llamar a funcion y generar tareas-->
      <div class="control-panel important">
        <ion-button
          expand="block"
          size="large"
          fill="solid"
          class="important-btn"
          (click)="getItemImportant()"
        >
          <span class="important-btn-text">Generar Tareas Importantes</span>
        </ion-button>
      </div>
      } @if (itemImportant.length > 0) { @for (itemImportant of itemImportant;
      track itemImportant.id){
      <div class="task-card" (click)="highlightTask(itemImportant.id)">
        <ion-card-header>
          <div class="card-header-content">
            <ion-badge [color]="getStatusColor(itemImportant.status)">
              {{ getStatusLabel(itemImportant.status) }}
            </ion-badge>
            <ion-card-title>{{ itemImportant.title }}</ion-card-title>
          </div>
        </ion-card-header>
      </div>
      } }
    </div>

    <div class="main-content">
      <div class="header-section">
        <h1>Bienvenido a tu Dashboard</h1>
        <p class="subtitle">
          Organiza y gestiona tus tareas de forma eficiente
        </p>
        <ion-button expand="block" class="add-button" (click)="openModal()">
          <ion-icon name="add-circle-outline" slot="start"></ion-icon>
          Nueva Tarea
        </ion-button>
      </div>

      @if (itemsDashboard.length === 0) {
      <div class="empty-state">
        <ion-icon name="clipboard-outline"></ion-icon>
        <h2>No hay tareas aún</h2>
        <p>Comienza creando tu primera tarea</p>
      </div>
      } @if (itemsDashboard.length > 0) {
      <div
        class="tasks-container"
        cdkDropList
        (cdkDropListDropped)="drop($event)"
      >
        @for (item of itemsDashboard; track item.id) {
        <ion-card
          [id]="'task-' + item.id"
          class="task-card"
          [class.completed]="item.status === 'completed'"
          [class.highlighted]="highlightedTaskId === item.id"
          cdkDrag
        >
          <ion-card-header>
            <div class="card-header-content">
              <ion-card-title>{{ item.title }}</ion-card-title>
              <ion-badge [color]="getStatusColor(item.status)">
                {{ getStatusLabel(item.status) }}
              </ion-badge>
            </div>
          </ion-card-header>

          <ion-card-content>
            <p class="description">
              {{ item.description || 'Sin descripción' }}
            </p>

            <div class="actions">
              <ion-button
                fill="outline"
                size="small"
                (click)="openEditModal(item)"
              >
                <ion-icon name="create-outline" slot="start"></ion-icon>
                Editar
              </ion-button>
              <ion-button
                fill="outline"
                size="small"
                color="danger"
                (click)="deleteItem(item.id)"
              >
                <ion-icon name="trash-outline" slot="start"></ion-icon>
                Eliminar
              </ion-button>
            </div>
          </ion-card-content>
        </ion-card>
        }
      </div>
      }
    </div>

    <div class="sidebar-right">
      @if (itemsDashboard.length > 0) {
      <div class="chart-container">
        <canvas
          baseChart
          [data]="statusChartData"
          [options]="statusChartOptions"
          [type]="'pie'"
        >
        </canvas>
      </div>
      <div class="chart-container activity-chart-container">
        <canvas
          baseChart
          [data]="statusChartData1"
          [options]="statusChartOptions1"
          [type]="'line'"
        >
        </canvas>
      </div>
      <ion-fab horizontal="end" vertical="bottom" slot="fixed">
        <ion-fab-button> Descargar Tareas </ion-fab-button>
        <ion-fab-list side="top">
          <ion-fab-button
            (click)="this.downloadItem('todas', itemsDashboard)"
          >
            Todas
          </ion-fab-button>
          <ion-fab-button
            (click)="this.downloadItem('completed', itemsDashboard)"
          >
            Completados
          </ion-fab-button>
          <ion-fab-button
            (click)="this.downloadItem('in-progress', itemsDashboard)"
          >
            En progreso
          </ion-fab-button>
          <ion-fab-button (click)="this.downloadItem('pending', itemsDashboard)"
            >Pendientes
          </ion-fab-button>
        </ion-fab-list>
      </ion-fab>
      }
    </div>
  </div>
</ion-content>
